<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>واتساب العرب</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background-color: #0b141a; color: #e9edef; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* الهيدر العلوي */
        header { background: #202c33; padding: 10px 20px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        header h2 { font-size: 18px; margin: 0; color: #e9edef; }

        /* منطقة الرسائل */
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-attachment: fixed; }

        /* فقاعة الرسالة */
        .msg-container { display: flex; flex-direction: column; max-width: 85%; position: relative; padding: 6px 10px; border-radius: 8px; font-size: 14.5px; line-height: 1.4; }
        
        /* رسائلك (اليمين) */
        .my-msg { align-self: flex-start; background-color: #005c4b; border-radius: 8px 0 8px 8px; margin-right: auto; }
        
        .sender-name { font-weight: bold; font-size: 12px; color: #ffd700; margin-bottom: 2px; display: block; }
        .msg-text { word-wrap: break-word; }
        
        /* وقت الرسالة وزر الحذف */
        .msg-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 4px; font-size: 10px; color: #b1b3b5; gap: 10px; }
        .delete-btn { color: #ff8a8a; cursor: pointer; text-decoration: none; }

        /* منطقة الإدخال */
        #input-area { background: #202c33; padding: 10px; display: flex; align-items: center; gap: 8px; }
        input { flex: 1; background: #2a3942; border: none; padding: 10px 15px; border-radius: 20px; color: white; outline: none; font-size: 15px; }
        button { background: #00a884; color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <h2>خادم العرب (مباشر)</h2>
    </header>

    <div id="messages">جاري المزامنة...</div>

    <div id="input-area">
        <input type="text" id="msgInput" placeholder="اكتب رسالة">
        <button id="sendBtn">➤</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAdTv9EK39xnUOz7UcUNzqgsYOgdPj9QMQ",
            authDomain: "khadimalarab.firebaseapp.com",
            projectId: "khadimalarab",
            storageBucket: "khadimalarab.firebasestorage.app",
            messagingSenderId: "396207379314",
            appId: "1:396207379314:web:aabe50a50ecd6adda503eb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const myName = "doflamingo10"; // اسمك الثابت

        // إرسال رسالة
        document.getElementById('sendBtn').onclick = async () => {
            const input = document.getElementById('msgInput');
            if (input.value.trim() !== "") {
                await addDoc(collection(db, "chats"), {
                    text: input.value,
                    userName: myName,
                    time: serverTimestamp()
                });
                input.value = '';
            }
        };

        // عرض الرسائل بتنسيق واتساب
        const q = query(collection(db, "chats"), orderBy("time", "asc"));
        onSnapshot(q, (snapshot) => {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            snapshot.forEach((messageDoc) => {
                const data = messageDoc.data();
                const date = data.time ? new Date(data.time.seconds * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '...';
                
                const msgCard = document.createElement('div');
                msgCard.className = 'msg-container my-msg';
                msgCard.innerHTML = `
                    <span class="sender-name">${data.userName}</span>
                    <div class="msg-text">${data.text}</div>
                    <div class="msg-footer">
                        <span>${date}</span>
                        <span class="delete-btn" onclick="window.deleteMsg('${messageDoc.id}')">حذف</span>
                    </div>
                `;
                messagesDiv.appendChild(msgCard);
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });

        // وظيفة الحذف
        window.deleteMsg = async (id) => {
            if(confirm("حذف الرسالة نهائياً؟")) {
                await deleteDoc(doc(db, "chats", id));
            }
        };
    </script>
</body>
</html>
